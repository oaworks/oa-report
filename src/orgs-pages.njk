---
layout: layouts/base.njk
pagination:
    data: orgs.hits.hits
    size: 1
    alias: org
permalink: "{{ org._source.objectID | slug }}/"
---

{%- from "system/component.njk" import component -%}

<main class="bg-carnation-100">
  <div class="px-3 md:px-6">
    <div class="grid grid-cols-2 gap-3 sm:gap-6 md:gap-12 py-3 xl:pb-6 xl:pt-12">
      <header class="mb-4 col-span-2 md:col-span-2">
        <h1 class="flex items-center">
          <div>
            <span class="font-semibold uppercase text-sm md:text-base line-thru">
              <span class="bg-carnation-100 pr-3">
                {% if org._source.policy.has_policy === true %}Put OA policy into practice at {% else %}Advance OA at {% endif %}
              </span>
            </span>
            <span class="text-2xl md:text-4xl font-light highlight">{{ org._source.name }}</span>
          </div>
          <span class="ml-6 lg:h-14 lg:w-14 rounded-full bg-carnation-500"></span>
        </h1>

        <h2 class="sr-only" id="report-range">
          Since the start of 2023
        </h2>
      </header>
    </div>
  </div>

  <nav class="sticky top-0 pt-3 md:pt-6 z-20 bg-carnation-100 transition-pb-0" id="top_nav">
    <h2 class="sr-only">See the report by year</h2>
    <ul class="mx-3 md:mx-6">
      <li class="inline-block mr-3">
        {{ component("year-select", {
          id: "start-year",
          txt: "",
          selected: true
        }) }}
      </li>
      {% if org._source.paid == true %}
      <li class="inline-block mr-3">
        {{ component("year-select", {
          id: "last-year",
          txt: ""
        }) }}
      </li>
      <li class="inline-block mr-3">
        {{ component("year-select", {
          id: "two-years-ago",
          txt: ""
        }) }}
      </li>
      <li class="inline-block mr-3">
        {{ component("year-select", {
          id: "all-time",
          txt: "All time"
        }) }}
      </li>
      {% else %}
      <li class="inline-block mr-3 lg:mr-6 px-3 py-2 md:px-6 md:py-4 text-xs md:text-lg bg-white text-neutral-900 border opacity-50">
        2022
      </li>
      <li class="inline-block mr-3 lg:mr-6 px-3 py-2 md:px-6 md:py-4 text-xs md:text-lg bg-white text-neutral-900 border opacity-50">
        2021
      </li>
      <li class="inline-block mr-3 lg:mr-6 px-3 py-2 md:px-6 md:py-4 text-xs md:text-lg bg-white text-neutral-900 border opacity-50">
        All time
      </li>
      <li class="inline-block">
        {{ component("tooltip", {
          msg: "<strong>Access previous years’ reports</strong><br> Upgrade to a <a href='https://about.oa.report/about/pricing#premium' target='_blank' class='underline underline-offset-2 decoration-1'>premium OA.Report</a> to understand your trends. Start now by <a href='#about-free-logged-out' class='underline underline-offset-2 decoration-1'>signing up</a>."}) 
        }}
      </li>
      {% endif %}
    </ul>
  </nav>

  {# INSIGHTS #}
  <section class="bg-neutral-900 text-white scroll-mt-32 js_section" id="insights">
    <div class="p-3 md:px-6 md:py-16">
      <header class="col-span-3">
        <h2 class="mb-4 text-base md:text-lg leading-6">
          <span class="font-semibold uppercase text-sm md:text-base line-thru">
            <span class="bg-neutral-900">
              Insights on <strong class="font-bold">articles</strong>
              {{ component("tooltip", {
                msg: "The <em>Insights</em> section provides a quick overview of your organization’s Open Access statistics. Our data sources are listed on our <a href='https://oa.works/developers/infrastructure/' target='_blank' class='underline underline-offset-2 decoration-1'>infrastructure page</a>."
              }) }}
            </span>
          </span>
        </h2>
      </header>

      <div class="grid gap-3 md:gap-6 grid-cols-2 md:grid-cols-4 lg:grid-cols-none lg:grid-flow-col xl:auto-cols-fr">
        {{ component("card", {
          id: "is_paper",
          title: "Total published",
          subtitle: "Article count",
          icon: "file-text"
        }) }}

        {{ component("card", {
          id: "is_free_to_read",
          title: "Free-to-read",
          subtitle: "Incl. temporarily accessible articles",
          icon: "gift"
        }) }}

        {{ component("card", {
          id: "is_compliant",
          title: "OA policy-compliant",
          subtitle: "Specific to your policy",
          icon: "check-circle"
        }) }}

        {{ component("card", {
          id: "is_oa",
          title: "Open Access",
          "subtitle": "Free and CC BY or public domain",
          icon: "unlock"
        }) }}

        {{ component("card", {
          id: "has_data_availability_statement",
          title: "With data availability statements",
          icon: "search"
        }) }}

        {{ component("card", {
          id: "has_open_data",
          title: "With Open Data",
          icon: "database"
        }) }}

        {{ component("card", {
          id: "has_open_code",
          title: "With Open Code",
          icon: "code"
        }) }}
      </div>

      {# <div class="sticky bottom-3 md:bottom-6 md:static mt-6 col-span-3 shadow-lg" id="insights_bar_container">
        <div class="bg-carnation-100 h-10 relative transition-all duration-1000" id="insights_bar">
          <span class="absolute inset-0 flex items-center justify-center text-neutral-800 text-xs md:text-sm font-semibold uppercase z-10 p-1" id="insights_text">Click on an Insight to visualise it</span>
          <div class="bg-carnation-300 h-10 transition-all duration-1000 absolute top-0 left-0" style="width: 0%;" id="insights_superset"></div>
          <div class="bg-carnation-500 h-10 transition-all duration-1000 absolute top-0 left-0" style="width: 0%;" id="insights_subset"></div>
        </div>
      </div> #}
    </div>
  </section>

  {# temp prototyping for vis #}
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const insightsBarContainer = document.querySelector('#insights_bar_container');
      const insightsBar = document.querySelector('#insights_bar');
      const insightsText = document.querySelector('#insights_text');
      const insightsSubset = document.querySelector('#insights_subset');
      const insightsSuperset = document.querySelector('#insights_superset');
      const yearButton2023 = document.querySelector('#start-year');
      const allTimeButton = document.querySelector('#all-time');
      let clickedHeader = null;

      function getCurrentYear() {
        if (yearButton2023.getAttribute('aria-pressed') === "true" && yearButton2023.textContent.trim() === "2023") {
            return '2023';
        } else if (allTimeButton.getAttribute('aria-pressed') === "true" && allTimeButton.textContent.trim() === "All time") {
            return 'allTime';
        } else {
            return null;
        }
      }

      function resetBars() {
          insightsSubset.style.width = '0%';
          insightsSuperset.style.width = '0%';
          insightsBar.classList.remove('striped-bg', 'bg-neutral-400');
          insightsText.textContent = 'Click on an Insight to visualise it';
      }

      function clearActiveStyles() {
          if (clickedHeader) {
              clickedHeader.parentElement.classList.remove('outline', 'outline-offset-2', 'outline-2', 'outline-carnation-300');
              clickedHeader = null;
          }
      }

      function handleInteraction(event, eventData, makeActive) {
        const currentYear = getCurrentYear();
        if (!currentYear) return;

        insightsSubset.style.width = eventData[currentYear].subset;
        insightsSuperset.style.width = eventData[currentYear].superset;
        insightsBar.classList.add('striped-bg', 'bg-neutral-400');

        if (eventData[currentYear].text) {
            if (insightsText) {
                insightsText.innerHTML = eventData[currentYear].text;
            }
        } else {
            const insightsText = document.querySelector('#insights_text');
            if (insightsText) {
                insightsText.innerHTML = ''; // Reset the text if there's no text associated
            }
        }

        const parentCard = event.currentTarget.parentElement;
        if (makeActive) {
            clearActiveStyles();
            parentCard.classList.add('outline', 'outline-offset-2', 'outline-2', 'outline-carnation-300');
            clickedHeader = event.currentTarget;
        } else {
            parentCard.classList.remove('outline', 'outline-offset-2', 'outline-2', 'outline-carnation-300');
        }
      }

      const events = [
        { 
          el: '#is_paper > header', 
          2023: {
              subset: '0%',
              superset: '100%',
              text: '40 articles in total'
          },
          allTime: {
              subset: '0%',
              superset: '100%',
              text: '3,049 articles in total'
          }
        },
        { 
          el: '#is_free_to_read > header', 
          2023: {
              subset: '85%',
              superset: '100%',
              text: '34 free-to-read articles of 40 articles'
          },
          allTime: {
              subset: '92.62%',
              superset: '100%',
              text: '2,824 free-to-read articles of 3,049 articles'
          }
        },
        { 
          el: '#is_compliant > header', 
          2023: {
              subset: '47.5%',
              superset: '92.5%',
              text: '19 policy-compliant articles of 37 articles covered'
          },
          allTime: {
              subset: '60.79%',
              superset: '94.66%',
              text: '1,854 policy-compliant articles of 2,886 articles covered'
          }
        },
        { 
          el: '#is_oa > header', 
          2023: {
              subset: '42.5%',
              superset: '100%',
              text: '17 OA articles of 40 articles'
          },
          allTime: {
              subset: '52.97%',
              superset: '100%',
              text: '1,615 OA articles of 3,049 articles'
          }
        },
        { 
          el: '#has_data_availability_statement > header', 
          2023: {
              subset: '52.5%',
              superset: '95%',
              text: '21 of 38 articles checked have a data availability statement'
          },
          allTime: {
              subset: '52.06%',
              superset: '96.03%',
              text: '1,587 of 2,928 articles checked have a data availability statement'
          }
        },
        { 
          el: '#has_open_data > header', 
          2023: {
              subset: '0%',
              superset: '0%',
              text: '<span class="text-white">No info available yet</span>'
          },
          allTime: {
              subset: '1.67%',
              superset: '13.18%',
              text: '<span class="text-white">51 of 402 articles with data have open data</span>'
          }
        },
        { 
          el: '#has_open_code > header', 
          2023: {
              subset: '0%',
              superset: '0%',
              text: '<span class="text-white">No info available yet</span>'
          },
          allTime: {
              subset: '0.23%',
              superset: '9.91%',
              text: '<span class="text-white">7 of 302 articles with code have open code</span>'
          }
        }
      ];

      if (insightsBarContainer) {
        events.forEach(event => {
          const header = document.querySelector(event.el);
          
          header.addEventListener('mouseenter', e => handleInteraction(e, event, false)); // Inactive on mouse enter

          header.addEventListener('mouseleave', e => {
            if (clickedHeader !== e.currentTarget) { // Only reset if it's not the clicked one
              resetBars();
            }
          });

          header.addEventListener('click', e => {
            e.stopPropagation();
            handleInteraction(e, event, true); // Active on click
          });
        });

        // Reset everything when clicked outside
        document.addEventListener('click', () => {
            clearActiveStyles();
            resetBars();
        });
      }
    });
  </script>

  {# EXPLORE #}
  {% if org._source.paid == true %}
  <section class="bg-neutral-800 text-white scroll-mt-32 js_section" id="explore">
    <div class="p-3 md:px-6 md:py-16">
      
      <header class="col-span-3">
        <h2 class="text-base md:text-lg leading-6">
          <span class="font-semibold uppercase text-sm md:text-base line-thru">
            <span class="bg-neutral-800">
              Data exploration
              {{ component("tooltip", {
                msg: "Lorem ipsum dolor sit amet."
              }) }}
            </span>
          </span>
        </h2>
      </header>

      <div class="flex flex-wrap space-r-4 space-b-4 items-center" id="explore_buttons"></div>

      <div class="relative">
        <div id="loading-indicator" class="hidden">
          <div class="loader ease-linear rounded-full border-8 border-t-8 border-carnation-200 border-t-carnation-500 h-12 w-12 absolute mt-6 mx-auto inset-x-0 z-10 bg-opacity-50 justify-center items-center"></div>
        </div>
      </div>
      
      <div id="export_table" class="mt-6 hidden">
        <h3 class="mb-12 text-4xl" aria-live="polite">
          Top <strong class="lowercase explore_type">articles</strong> for <strong class="lowercase report_year">2023</strong>
          {{ component("tooltip", {
            msg: "This table is a preview of all the records for your query. To see the full data set in CSV format, use the <em>Download full data (CSV)</em> button."
          }) }} 
        </h3> 
        <div class="my-4 gap-3 md:gap-6 grid grid-cols-1 md:grid-cols-2">
          <form class="col-span-1 w-auto">
            <fieldset id="explore_form">
              <legend class="mb-3 text-xs font-semibold uppercase">Filter by</legend>
              <div class="flex flex-wrap items-center" id="explore_filters"></div>
            </fieldset>
          </form>
          <div class="col-span-1 md:justify-self-end w-auto">            
            <label for="toggler-data-view" class="mb-3 text-xs font-semibold uppercase">Data display style</label>
            <div class="flex items-center">
              <span class="mr-2 text-xs">Pretty</span>
                <button id="toggle-data-view" type="button" class="relative inline-flex h-5 w-10 flex-shrink-0 cursor-pointer items-center justify-center rounded-full focus:outline-none focus:ring-2 focus:ring-carnation-500 focus:ring-offset-2" role="switch" aria-checked="true">
                  <span aria-hidden="true" class="bg-carnation-500 pointer-events-none absolute mx-auto h-4 w-9 rounded-full transition-colors duration-200 ease-in-out"></span>
                  <span aria-hidden="true" class="translate-x-100 pointer-events-none absolute left-0 inline-block h-5 w-5 transform rounded-full border border-neutral-500 bg-neutral-800 shadow ring-0 transition-transform duration-200 ease-in-out"></span>
                </button>
              <span class="ml-2 text-xs">Raw</span>
            </div>
          </div>          
        </div>
        <div class="relative">
          <button
            id="js_scroll_table_btn"
            class="p-2 bg-carnation-100 text-neutral-900 text-2xl focus:outline-none focus:ring focus:ring-carnation-500 hover:bg-carnation-300 transition duration-300 ml-4 absolute right-3 top-1/2 transform -translate-y-1/2"
            aria-label="Scroll to see more of the table"
          >
            →
          </button>
          <div class="mb-4 overflow-x-auto border border-neutral-200 js_export_table_container">
            <table class="border-collapse w-full table-fixed js_export_table">
              <thead class="border-b border-neutral-200 text-left text-xs font-medium uppercase tracking-wider" id="export_table_head"></thead>
              <tbody class="text-xs md:text-sm" id="export_table_body"></tbody>
            </table>
          </div>
        </div>
        {# TODO: allow downloading of all data in CSV #}
        {# <div class="flex justify-between">
          <div class="text-right">
            <a href="/temp/bmgf_all-articles_from_2023-01-01-to-2023-10-04_on_2023-09-27.csv" 
              download 
              role="button" 
              aria-label="Download full data as CSV"
              id="export_link"
              class="items-center space-x-2 px-4 py-2 text-base font-medium uppercase border border-neutral-100 text-neutral-100 bg-neutral-800 hover:bg-neutral-100 hover:text-neutral-900 focus:outline-none focus:ring-1 focus:ring-carnation-400 duration-500 whitespace-nowrap inline-block">
                Download all <span class="js_export_type">data</span> (CSV)
            </a>
          </div>
        </div> #}
      </div>
    </div>
  </section>
  {% endif %}
  
  {# ACTIONS #}
  <section class="bg-neutral-700 text-white scroll-mt-32 js_section relative" id="strategies">
    <div class="px-3 md:px-6 md:py-16">
      <div class="grid grid-cols-2 gap-3 sm:gap-6 md:gap-12 py-6 xl:py-12"> 
        <div class="col-span-2">
          <h2 class="leading-6 font-semibold uppercase text-sm md:text-base line-thru">
            <span class="bg-neutral-700">
              Actions
              {{ component("tooltip", {
                msg: "The <em>Strategy</em> section provides actionable steps for making more of your articles Open Access."
              }) }}
            </span>
          </h2>
          

          <nav class="hidden sm:block mt-6 mb-10">
            <h3 class="absolute right-0 bottom-0 text-9xl font-black text-white opacity-20">
              <span class="sr-only">Actions for </span><span class="export-year" id="report-year">2023</span>
            </h3>
            <ul class="flex flex-wrap space-r-4 space-b-4 items-center" role="tablist" aria-label="Actions Tabs">
              {{ component("strategy-pill", {
                id: "email_author_vor",
                txt: "Deposit publisher PDFs",
                class: "font-semibold bg-carnation-300",
                first: true
              }) }}

              {{ component("strategy-pill", {
                id: "email_author_aam",
                txt: "Deposit accepted manuscripts"
              }) }}

              {{ component("strategy-pill", {
                id: "apc_followup",
                txt: "Correct publisher errors"
              }) }}

              {{ component("strategy-pill", {
                id: "unanswered_requests",
                txt: "Escalate unanswered requests"
              }) }}
            </ul>
          </nav>

          <div class="hidden sm:block js_strategies">
            {{ component("strategy-contents", {
              id: "email_author_vor",
              heading: "Deposit publisher PDFs",
              desc: "Send emails to authors to request they make their work free to read. In these cases, they can do that by making a <strong>publisher PDF (version of record, VOR)</strong> available in a repository.",
              table_headings: "<th scope='col' class='py-3.5 pl-4 pr-3 text-left text-sm font-semibold w-10/12 sm:w-6/12'>Article</th>\
                              <th scope='col' class='hidden px-3 py-3.5 text-left text-sm font-semibold w-4/12 sm:table-cell'>Corresponding author</th>",
              draft_btn: true,
              action_help_txt: true,
              hidden: false
            }) }}

            {{ component("strategy-contents", {
              id: "email_author_aam",
              heading: "Deposit accepted manuscripts",
              desc: "Send emails to authors to request they make their work free to read. In these cases, they can do that by making an <strong>author accepted manuscript (AAM)</strong> available in a repository.",
              table_headings: "<th scope='col' class='py-3.5 pl-4 pr-3 text-left text-sm font-semibold w-10/12 sm:w-6/12'>Article</th>\
                              <th scope='col' class='hidden px-3 py-3.5 text-left text-sm font-semibold w-4/12 sm:table-cell'>Corresponding author</th>",
              draft_btn: true,
              action_help_txt: true,
              hidden: true
            }) }}

            {{ component("strategy-contents", {
              id: "apc_followup",
              heading: "Correct publisher errors",
              desc: "These are articles where an APC has been paid, but the article isn't compliant with the policy. Use this list to follow up with publishers. If an article is made compliant, and the metadata is updated, it will be removed from this list.",
              table_headings: "<th scope='col' class='py-3.5 pl-4 pr-3 text-left text-sm font-semibold w-4/12 sm:w-4/12'>Publisher & journal</th>\
                              <th scope='col' class='py-3.5 pl-4 pr-3 text-left text-sm font-semibold w-3/12 sm:w-4/12'>Article</th>\
                              <th scope='col' class='py-3.5 pl-4 pr-3 text-left text-sm font-semibold w-5/12 sm:w-4/12'>Invoice</th>",
              draft_btn: false,
              action_help_txt: false,
              hidden: true
            }) }}

            {{ component("strategy-contents", {
              id: "unanswered_requests",
              heading: "Escalate unanswered requests",
              desc: "These articles are not compliant with policy, and their authors haven’t answered multiple requests to comply. Use this list to escalate requests to authors and request they make their work freely available.",
              table_headings: "<th scope='col' class='py-3.5 pl-4 pr-3 text-left text-sm font-semibold w-3/12'>Grant</th>\
                              <th scope='col' class='px-3 py-3.5 text-left text-sm font-semibold w-7/12'>Author & article</th>",
              draft_btn: true,
              action_help_txt: false,
              hidden: true
            }) }}
          </div>

          <div class="sm:hidden text-base mt-6">
            <p>Actions aren’t available on mobile yet. Please head to a desktop computer to take action!</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  {# ABOUT #}
  <section class="px-3 md:px-6 md:py-16">
    <div class="grid grid-cols-2 gap-3 sm:gap-6 md:gap-12 py-6 xl:py-12"> 
      <div class="col-span-2 grid md:grid-cols-2 gap-12 text-base md:text-2xl md:leading-8 md:font-light" id="about">
        <div>
          <h2 class="font-semibold uppercase text-sm md:text-base line-thru">
            <span class="bg-carnation-100 pr-3">About this report</span>
          </h2>
          {# PAID USERS #}
          {% if org._source.paid == true %}
          <p class="my-6">
            <strong class="text-bold">{{ org._source.name }}</strong>’s custom OA.Report uses <a href="https://about.oa.report/docs/sources" target="_blank" class="underline underline-offset-4 decoration-1">all our data sources</a> and state-of-the-art analysis to provide insights into their publications, impact, and how open their research is.
          </p>
          <p class="my-6" id="about-paid-logged-out">
            <a href="https://about.oa.report/docs/user-accounts" target="_blank" class="underline underline-offset-4 decoration-1">Log in</a> to see the OA.Report.
          </p>
          {# FREE USERS #}
          {% else %}
          <p class="my-6">
            <strong class="text-bold">{{ org._source.name }}</strong>’s OA.Report uses <a href="https://about.oa.report/docs/sources#open-sources" target="_blank" class="underline underline-offset-4 decoration-1">open data</a> and automated analysis to provide insights into their publication volume and how open their research is.
          </p>
          <div id="about-free-logged-out">
            <h2 class="font-semibold uppercase text-sm md:text-base line-thru">
              <span class="bg-carnation-100 pr-3">Unlock your institution’s research</span>
            </h2>
            <p class="my-6">
              Sign up to access your institution's Actions for free. Consider a <a href="https://about.oa.report/pricing" target="_blank" class="underline underline-offset-4 decoration-1">paid plan</a> to help <a href="https://about.oa.report/docs/sources" target="_blank" class="underline underline-offset-4 decoration-1">discover all your papers</a> and provide up-to-date, deep insights into the state of open at your institution.
            </p>
            <div class="my-6 w-6/12">
              {% include 'partials/signup-form.njk' %}
            </div>
          </div>
          {% endif %}
        </div>
        {# PROMPT TO SEARCH OTHER ORGS #}
        <div>
          <h2 class="font-semibold uppercase text-sm md:text-base line-thru">
            <span class="bg-carnation-100 pr-3">Find other organizations</span>
          </h2>
          <div class="my-6">
            {% if page.url != "/" %}
              {{ component("search-form", {
                sr_only: true
              }) }}
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </section>

  {# Dynamic modal #}
  {# <div id="dynamic-modal" class="fixed inset-0 flex items-center justify-center p-4 bg-neutral-900 bg-opacity-50 hidden transition-opacity duration-300 z-50" aria-hidden="true" tabindex="-1" role="dialog" aria-modal="true">
    <div class="bg-carnation-100 text-neutral-900 p-3 md:p-6 shadow-lg md:w-8/12 overflow-y-auto max-h-[80vh] min-h-0" role="document">
      <div class="flex justify-between items-start">
        <h2 class="modal-title text-2xl font-semibold"></h2>
        <button class="close-modal-btn text-2xl font-semibold text-neutral-700 hover:text-neutral-900">
          <span class="sr-only">Close modal</span>
          &times;
        </button>
      </div>
      <div class="modal-content mt-4"></div>
    </div>
  </div> #}

  {# Container for all export modals’ HTML content #}
  {# <div id="export_modals">
    {{ component("modal", {
      id: "custom_export",
      title: "Create your own",
      include: "custom-export-form"
    }) }}
  </div> #}
</main>

