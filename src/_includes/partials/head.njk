<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  {% if org._source.private == true or page.fileSlug == 'report-unavailable' or page.fileSlug == 'report-list' %}
  <meta name="robots" content="noindex">
  {% endif %}
  {% set env = (site.base_url or '') | lower %}
  {% set titlePrefix = '[STG] ' if 'staging.oa.report' in env or 'cf-stg.oa.report' in env else ('[DEV] ' if 'dev.oa.report' in env or 'cf-dev.oa.report' in env or 'localhost' in env else '') %}
  <title>{% if titlePrefix %}{{ titlePrefix }}{% endif %}{% if org._source.name %}{{ org._source.name }} — {% endif %}OA.Report: Unlock your research, simply</title>
  <meta name="description" content="{% if org._source.name %}Insights and actions for Open Access and OA policies at {{ org._source.name | safe }}{% else %}Find your publications, measure their openness, and take action to increase your Open Access policy compliance{% endif %}.">

  {# OpenGraph meta tags #}
  {# Facebook/Meta #}
  <meta property="og:url" content="https://oa.report">
  <meta property="og:type" content="website">
  <meta property="og:title" content="OA.Report: Unlock your research, simply">
  <meta property="og:description" content="{% if org._source.name %}Insights and actions for Open Access and OA policies at {{ org._source.name | safe }}{% else %}Find your publications, measure their openness, and take action to increase your Open Access policy compliance{% endif %}.">
  <meta property="og:image" content="https://oa.report/img/og_meta.png">

  {# Twitter #}
  <meta name="twitter:card" content="summary_large_image">
  <meta property="twitter:domain" content="oa.report">
  <meta property="twitter:url" content="https://oa.report">
  <meta name="twitter:title" content="OA.Report: Unlock your research, simply">
  <meta name="twitter:description" content="{% if org._source.name %}Insights and actions for Open Access and OA policies at {{ org._source.name | safe }}{% else %}Find your publications, measure their openness, and take action to increase your Open Access policy compliance{% endif %}.">
  <meta name="twitter:image" content="https://oa.report/img/twitter_meta.png">

  {# Preconnect to the CDN for our sans-serif font #}
  <link rel="preconnect" href="https://rsms.me/">

  {# Preload self-hosted Inter variable font #}
  <link rel="preload" href="../fonts/inter/InterVariable.woff2" as="font" type="font/woff2" crossorigin="anonymous">

  {# Preload self-hosted Redaction font #}
  <link rel="preload" href="../fonts/redaction/Redaction-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="../fonts/redaction/Redaction-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

  {# Load TailwindCSS #}
  <link rel="stylesheet" href="../tailwind.css">

  {# Load homepage-specific CSS and JS for Sal.js #}
  {% if page.url == '/' %}
  <link rel="stylesheet" href="../sal.css">
  {% endif %}

  {# Favicons #}
  <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
  <link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#ff6666">
  <meta name="msapplication-TileColor" content="#ff6666">
  <meta name="theme-color" content="#25201E">

  {# Detect any console errors and display in UI #}
  <script>
    window.addEventListener('error', function (event) {
      if (event.message?.includes('404') || event.message?.toLowerCase().includes('error')) {
        const alertMsg = document.getElementById("js-alert");
        alertMsg.textContent = "An error has occurred. Please try again later.";
        alertMsg.style.display = 'block';
      }
    }, true);
  </script>

  {# Apply login state class early to avoid nav layout shifts #}
  <script>
    (function () {
      try {
        const params = new URLSearchParams(window.location.search);
        let hasOrgKey = params.has('orgkey');
        if (!hasOrgKey && window.sessionStorage) {
          const path = window.location.pathname.replace(/^\/+|\/+$/g, '');
          const slug = path.split('/')[0];
          const key = slug ? `orgkey:${decodeURIComponent(slug)}` : 'orgkey';
          hasOrgKey = !!sessionStorage.getItem(key) || !!sessionStorage.getItem('orgkey');
        }
        document.documentElement.classList.toggle('has-orgkey', hasOrgKey);
      } catch (e) {
        // If parsing or storage access fails, keep default state
      }
    })();
  </script>

  {# Load UI-related JS for org report pages only #} 
  {% if org._source.name %}
  <script defer src="../js/axios.min.js"></script>
  <script defer src="../js/oaworksKeys.js"></script>
  <script type="module" src="../js/main.min.js"></script>
  {% endif %}

  {# Preconnect to the API endpoint #}
  <link rel="preconnect" href="https://bg.{{ env.ELEVENTY_API_ENDPOINT }}.oa.works">
  <link rel="preconnect" href="https://{{ env.ELEVENTY_API_ENDPOINT }}.oa.works">

  {# SimpleAnalytics tracking code (load early to capture URL params) #}
  <script 
    data-allow-params="breakdown,records,start,end,action,explore_filter,q"
    defer
    src="https://scripts.simpleanalyticscdn.com/latest.js">
  </script>

  {% block extra_head %}{% endblock %}
</head>
