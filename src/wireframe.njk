

{%- from "system/component.njk" import component -%}

<!DOCTYPE html>
<html lang="en">
  {% include 'partials/head.njk' %}
  <body class="bg-neutral-50 text-neutral-900 font-sans">

    <!-- Overlay to close mobile menu -->
    <div id="overlay" class="fixed inset-0 bg-black opacity-50 hidden sm:hidden" onclick="closeMobileMenu()" aria-hidden="true"></div>

    <!-- Top header including report title and menu button for mobile -->
    <header class="bg-white text-neutral-900 border-b border-neutral-200 p-4 shadow-sm sm:static sm:border-b-0 flex justify-between items-center sm:ml-52">
      <!-- Hamburger menu button for mobile only -->
      <button id="menu-toggle" aria-label="Open menu" aria-expanded="false" aria-controls="mobile-nav" class="sm:hidden bg-carnation-500 p-2 text-white focus:outline-none" onclick="toggleMobileMenu()">
        {% icon_small "menu" %}
        <span class="sr-only">MENU</span>
      </button>
      <div class="flex items-center">
        <h1 class="text-xl text-neutral-700 ml-4">Bill &amp; Melinda Gates Foundation</h1>
        <span id="selected-year" class="text-xl text-carnation-500 mx-4">2024</span>
      </div>
    </header>

    <!-- Date selection visible only on mobile, under the top nav -->
    <div class="bg-carnation-100 p-4 flex justify-between items-center sm:hidden">
      <!-- Dropdown for year selection (styled like a button) -->
      <div class="bg-white hover:bg-carnation-100 focus:outline-none border border-neutral-300 p-2 flex items-center space-x-3 font-medium text-sm w-full text-left relative">
        {% icon_small "calendar" %}
        <select id="year-select" aria-label="Select a year" class="appearance-none bg-transparent focus:outline-none w-full pr-6">
          <option value="2024">2024</option>
          <option value="2023">2023</option>
          <option value="2022">2022</option>
        </select>
        <!-- Custom caret for the dropdown -->
        <div class="absolute inset-y-0 right-2 flex items-center pointer-events-none">
          {% icon_small "chevron-down" %}
        </div>
      </div>

      <div class="font-medium text-xs text-center mx-4">OR</div>

      <!-- Date picker button -->
      <button aria-haspopup="dialog" aria-controls="modal" aria-expanded="false" aria-label="Open date range picker" class="bg-white hover:bg-carnation-100 focus:outline-none border border-neutral-300 p-2 flex items-center space-x-2 font-medium text-sm w-full text-left" onclick="toggleDateRangeModal(event)">
        {% icon_small "clock" %}
        <span>Pick date range</span>
      </button>
    </div>

    <!-- Mobile sliding menu (only for mobile) -->
    <nav id="mobile-nav" aria-label="Mobile navigation" aria-hidden="true" class="bg-white w-64 h-full fixed top-0 left-0 z-50 transform -translate-x-full transition-transform duration-300 ease-in-out shadow-lg sm:hidden">
      <div class="p-4 space-y-4">
        <h2 class="text-xl font-black mb-4">OA.Report</h2>
        <div class="text-xs font-semibold text-neutral-500 uppercase">Main menu</div>
        <a href="#insights" class="nav-link p-3 flex items-center space-x-2 font-medium hover:bg-carnation-100 text-sm">
          {% icon_small "bar-chart" %}
          <span>Overview</span>
        </a>
        <a href="#analysis" class="nav-link p-3 flex items-center space-x-2 font-medium hover:bg-carnation-100 text-sm">
          {% icon_small "grid" %}
          <span>Analysis</span>
        </a>
        <a href="#actions" class="nav-link p-3 flex items-center space-x-2 font-medium hover:bg-carnation-100 text-sm">
          {% icon_small "activity" %}
          <span>Actions</span>
        </a>

        <div class="text-xs font-semibold text-neutral-500 uppercase">Secondary</div>
        <a href="#about" class="nav-link p-3 flex items-center space-x-2 font-medium hover:bg-carnation-100 text-sm">
          {% icon_small "info" %}
          <span>About</span>
        </a>
        <a href="#logout" class="nav-link p-3 flex items-center space-x-2 font-medium hover:bg-carnation-100 text-sm">
          {% icon_small "log-out" %}
          <span>Log out</span>
        </a>
      </div>
    </nav>

    <!-- Desktop left nav -->
    <div class="flex h-full">
      <nav aria-label="Desktop navigation" id="left-nav" class="bg-white w-52 text-neutral-800 border-r border-neutral-200 shadow-md hidden sm:flex flex-col justify-between fixed inset-y-0 overflow-y-auto">
        <div>
          <h2 class="text-xl font-black p-4">OA.Report</h2>
          <div class="space-y-2">
            <!-- Add time filter section with dropdown for years -->
            <div class="bg-carnation-100 space-y-2 p-4">
              <div class="text-xs font-semibold text-neutral-700 uppercase">Date selection</div>
              <div class="bg-white hover:bg-carnation-100 focus:outline-none border border-neutral-300 p-2 flex items-center space-x-3 font-medium text-sm w-full text-left relative">
                {% icon_small "calendar" %}
                <select id="year-select" aria-label="Select a year" class="appearance-none bg-transparent focus:outline-none w-full pr-6">
                  <option value="2024">2024</option>
                  <option value="2023">2023</option>
                  <option value="2022">2022</option>
                </select>
                <div class="absolute inset-y-0 right-2 flex items-center pointer-events-none">
                  {% icon_small "chevron-down" %}
                </div>
              </div>

              <div class="font-medium text-xs text-center mx-4">OR</div>

              <!-- Date picker button -->
              <button aria-haspopup="dialog" aria-controls="modal" aria-expanded="false" aria-label="Open date range picker" class="bg-white hover:bg-carnation-100 focus:outline-none border border-neutral-300 p-2 flex items-center space-x-2 font-medium text-sm w-full text-left" onclick="toggleDateRangeModal(event)">
                {% icon_small "clock" %}
                <span>Pick date range</span>
              </button>
            </div>

            <!-- Main menu -->
            <div class="text-xs font-semibold text-neutral-700 uppercase p-4">Main menu</div>
            <a href="#insights" class="nav-link p-3 flex items-center space-x-2 font-medium hover:bg-carnation-100 transition duration-300 ease-in-out text-sm">
              {% icon_small "bar-chart" %}
              <span>Overview</span>
            </a>
            <a href="#analysis" class="nav-link p-3 flex items-center space-x-2 font-medium hover:bg-carnation-100 transition duration-300 ease-in-out text-sm">
              {% icon_small "grid" %}
              <span>Analysis</span>
            </a>
            <a href="#actions" class="nav-link p-3 flex items-center space-x-2 font-medium hover:bg-carnation-100 transition duration-300 ease-in-out text-sm">
              {% icon_small "activity" %}
              <span>Actions</span>
            </a>

            <!-- Secondary menu -->
            <div class="text-xs font-semibold text-neutral-700 uppercase p-4">Secondary</div>
            <a href="#about" class="nav-link p-3 flex items-center space-x-2 font-medium hover:bg-carnation-100 transition duration-300 ease-in-out text-sm">
              {% icon_small "info" %}
              <span>About</span>
            </a>
            <a href="#logout" class="nav-link p-3 flex items-center space-x-2 font-medium hover:bg-carnation-100 transition duration-300 ease-in-out text-sm">
              {% icon_small "log-out" %}
              <span>Log out</span>
            </a>
          </div>
        </div>
      </nav>

      <!-- Main content -->
      <main class="flex-grow sm:ml-52 p-6">
        <!-- Overview section -->
        {% include '_wireframe-insights.njk' %}

        <!-- Analysisr section -->
        {% include '_wireframe-explore.njk' %}

        <!-- Actions section -->
        {% include '_wireframe-actions.njk' %}
      </main>
    </div>

    <!-- Modal for date picker -->
    <div id="modal" role="dialog" aria-labelledby="modal-title" aria-hidden="true" class="fixed bg-white border border-neutral-300 p-4 hidden" style="z-index: 100;">
      <div class="flex justify-between items-center">
        <h2 id="modal-title" class="text-xl font-semibold">Pick a custom date range</h2>
        <button id="modal-close-btn" aria-label="Close date range picker" class="text-neutral-600 hover:text-neutral-700" onclick="toggleDateRangeModal()">
          {% icon_small "x" %}
        </button>
      </div>
      <label class="block mb-2">Start Date: <input type="date" class="border p-2"></label>
      <label class="block mb-4">End Date: <input type="date" class="border p-2"></label>
      <button class="bg-carnation-500 hover:bg-carnation-600 text-white p-2" onclick="toggleDateRangeModal()">Apply</button>
    </div>

    <script>
      // Toggle mobile nav and overlay
      function toggleMobileMenu() {
        const mobileNav = document.getElementById('mobile-nav');
        const overlay = document.getElementById('overlay');
        const menuToggle = document.getElementById('menu-toggle');
        const isOpen = mobileNav.classList.toggle('-translate-x-full');
        overlay.classList.toggle('hidden', isOpen);
        menuToggle.setAttribute('aria-expanded', !isOpen);
        mobileNav.setAttribute('aria-hidden', isOpen);
        if (!isOpen) {
          menuToggle.focus();
        }
      }

      // Close mobile menu when clicking outside
      function closeMobileMenu() {
        const mobileNav = document.getElementById('mobile-nav');
        const overlay = document.getElementById('overlay');
        const menuToggle = document.getElementById('menu-toggle');
        mobileNav.classList.add('-translate-x-full');
        overlay.classList.add('hidden');
        menuToggle.setAttribute('aria-expanded', 'false');
        mobileNav.setAttribute('aria-hidden', 'true');
        menuToggle.focus();
      }

      // Toggle the date picker modal
      function toggleDateRangeModal(event) {
        const modal = document.getElementById('modal');
        const isHidden = modal.classList.toggle('hidden');
        const button = event.currentTarget;
        const rect = button.getBoundingClientRect();
        modal.style.top = `${rect.bottom + window.scrollY}px`;
        modal.style.left = `${rect.left + window.scrollX}px`;
        button.setAttribute('aria-expanded', !isHidden);
      }

      // Highlight the active section based on the URL hash
      function activateSectionFromHash() {
        const hash = window.location.hash || '#insights'; // Default to 'insights' if no hash is present
        
        // Get both mobile and desktop links
        const mobileActiveLink = document.querySelector(`#mobile-nav .nav-link[href="${hash}"]`);
        const desktopActiveLink = document.querySelector(`#left-nav .nav-link[href="${hash}"]`);

        // Reset both mobile and desktop nav links
        document.querySelectorAll('#mobile-nav .nav-link, #left-nav .nav-link').forEach(nav => {
          nav.classList.remove('bg-carnation-100', 'font-bold');
        });

        // Apply the active class to both the mobile and desktop active links if found
        if (mobileActiveLink) {
          mobileActiveLink.classList.add('bg-carnation-100', 'font-bold');
        }
        if (desktopActiveLink) {
          desktopActiveLink.classList.add('bg-carnation-100', 'font-bold');
        }

        // Hide all sections and show the target section
        document.querySelectorAll('.section').forEach(section => section.classList.add('hidden'));
        const targetSection = document.querySelector(hash);
        if (targetSection) {
          targetSection.classList.remove('hidden');
        }
      }

      // Call the function initially to highlight the correct tab on page load
      activateSectionFromHash();

      // Listen for changes to the URL hash (when clicking links or navigating)
      window.addEventListener('hashchange', activateSectionFromHash);

    </script>
  </body>
</html>