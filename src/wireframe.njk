<!DOCTYPE html>
<html lang="en">
  {% include 'partials/head.njk' %}
  <body class="bg-neutral-50 text-neutral-900 font-sans">

    <div class="flex h-screen">
      <!-- Left nav that takes up the full height -->
      <nav aria-label="Primary" id="left-nav" class="bg-white w-52 text-neutral-800 border-r border-neutral-200 shadow-md hidden sm:flex flex-col justify-between fixed inset-y-0 overflow-y-auto">
        <div class="space-y-2">
          <h2 class="text-2xl font-bold p-4">OA.Report</h2>

          <!-- Add time filter section with dropdown for years -->
          <div class="bg-carnation-100 space-y-2 p-4">
            <div class="text-xs font-semibold text-neutral-700 uppercase">Date selection</div>
            <!-- Dropdown for year selection (now styled like a button) -->
            <div class="bg-white hover:bg-carnation-100 focus:outline-none border border-neutral-300 p-2 flex items-center space-x-3 font-medium text-sm w-full text-left relative">
              {% icon_small "calendar" %}
              <select id="year-select" aria-label="Select a year" class="appearance-none bg-transparent focus:outline-none w-full pr-6">
                <option value="2024">2024</option>
                <option value="2023">2023</option>
                <option value="2022">2022</option>
              </select>
              <!-- Custom caret for the dropdown -->
              <div class="absolute inset-y-0 right-2 flex items-center pointer-events-none">
                {% icon_small "chevron-down" %}
              </div>
            </div>

            <!-- Date picker button -->
            <button aria-haspopup="dialog" aria-controls="modal" aria-expanded="false" aria-label="Open date range picker" class="bg-white hover:bg-carnation-100 focus:outline-none border border-neutral-300 p-2 flex items-center space-x-2 font-medium text-sm w-full text-left" onclick="toggleDateRangeModal(event)">
              {% icon_small "clock" %}
              <span>Pick date range</span>
            </button>
          </div>

          <!-- Main menu -->
          <div class="text-xs font-semibold text-neutral-700 uppercase p-4">Main menu</div>
          <a href="#insights" class="nav-link p-3 flex items-center space-x-2 font-medium hover:bg-neutral-100 focus:ring-2 focus:ring-carnation-500 transition duration-300 ease-in-out text-sm">
            {% icon_small "bar-chart" %}
            <span>Insights</span>
          </a>
          <a href="#data-explore" class="nav-link p-3 flex items-center space-x-2 font-medium hover:bg-neutral-100 focus:ring-2 focus:ring-carnation-500 transition duration-300 ease-in-out text-sm">
            {% icon_small "grid" %}
            <span>Data explore</span>
          </a>
          <a href="#actions" class="nav-link p-3 flex items-center space-x-2 font-medium hover:bg-neutral-100 focus:ring-2 focus:ring-carnation-500 transition duration-300 ease-in-out text-sm">
            {% icon_small "activity" %}
            <span>Actions</span>
          </a>

          <!-- Secondary menu -->
          <div class="text-xs font-semibold text-neutral-700 uppercase p-4">Secondary</div>
          <a href="#about" class="nav-link p-3 flex items-center space-x-2 font-medium hover:bg-neutral-100 focus:ring-2 focus:ring-carnation-500 transition duration-300 ease-in-out text-sm">
            {% icon_small "info" %}
            <span>About</span>
          </a>
          <a href="#logout" class="nav-link p-3 flex items-center space-x-2 font-medium hover:bg-neutral-100 focus:ring-2 focus:ring-carnation-500 transition duration-300 ease-in-out text-sm">
            {% icon_small "log-out" %}
            <span>Log out</span>
          </a>
        </div>
      </nav>

      <!-- Content section and top nav next to the left nav -->
      <div class="flex-grow sm:ml-52">
        <!-- Sticky top navigation bar -->
        <nav aria-label="Secondary" class="bg-white text-neutral-900 border-b border-neutral-200 p-4 shadow-sm sticky top-0 z-50 flex justify-between items-center">
          <div class="flex items-center space-x-4">
            <!-- Organization name and selected year/date range -->
            <div class="flex items-center">
              <h1 class="text-xl text-neutral-600">Bill & Melinda Gates Foundation</h1>
              <!-- Date range or year will be displayed here -->
              <span id="selected-year" class="text-xl text-carnation-600 mx-4">2024</span>
            </div>
          </div>
          <!-- Mobile menu button -->
          <button id="menu-toggle" class="sm:hidden bg-carnation-500 p-2 text-white" onclick="toggleMobileMenu()">
            {% icon_small "menu" %}
            Menu
          </button>
        </nav>

        <!-- Main content -->
        <main class="p-6 bg-neutral-50">
          <section id="insights" class="section scroll-mt-16">
            <h2 class="text-2xl font-bold mb-6">Insights</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
              <div class="bg-white p-6 border border-neutral-300">
                <h2 class="text-xl font-semibold text-neutral-700">Total publications</h2>
                <p class="text-4xl mt-2 text-neutral-900">2,365</p>
              </div>
              <div class="bg-white p-6 border border-neutral-300">
                <h2 class="text-xl font-semibold text-neutral-700">Free-to-read</h2>
                <p class="text-4xl mt-2 text-neutral-900">90%</p>
              </div>
              <div class="bg-white p-6 border border-neutral-300">
                <h2 class="text-xl font-semibold text-neutral-700">OA policy-compliant</h2>
                <p class="text-4xl mt-2 text-neutral-900">83%</p>
              </div>
              <div class="bg-white p-6 border border-neutral-300">
                <h2 class="text-xl font-semibold text-neutral-700">With data availability</h2>
                <p class="text-4xl mt-2 text-neutral-900">74%</p>
              </div>
            </div>
          </section>

          <section id="data-explore" class="section hidden scroll-mt-16">
            <h2 class="text-2xl font-bold mb-6">Data exploration</h2>
          </section>

          <section id="actions" class="section hidden scroll-mt-16">
            <h2 class="text-2xl font-bold mb-6">Actions</h2>
          </section>
        </main>
      </div>
    </div>

    <!-- Modal for date picker -->
    <div id="modal" role="dialog" aria-labelledby="modal-title" aria-hidden="true" class="fixed bg-white border border-neutral-300 p-4 hidden" style="z-index: 100;">
      <div class="flex justify-between items-center">
        <h2 id="modal-title" class="text-xl font-semibold">Pick a custom date range</h2>
        <button id="modal-close-btn" aria-label="Close date range picker" class="text-neutral-600 hover:text-neutral-900" onclick="toggleDateRangeModal()">
          {% icon_small "x" %}
        </button>
      </div>
      <label class="block mb-2">Start Date: <input type="date" class="border p-2"></label>
      <label class="block mb-4">End Date: <input type="date" class="border p-2"></label>
      <button class="bg-carnation-500 hover:bg-carnation-600 text-white p-2" onclick="toggleDateRangeModal()">Apply</button>
    </div>

    <script>
      function toggleDateRangeModal(event) {
        const modal = document.getElementById('modal');
        modal.classList.toggle('hidden');

        // Get the button's position and place the modal accordingly
        const button = event.currentTarget;
        const rect = button.getBoundingClientRect();

        // Position the modal next to the button
        modal.style.top = `${rect.bottom + window.scrollY}px`;
        modal.style.left = `${rect.left + window.scrollX}px`;
      }

      function updateYear() {
        const yearSelect = document.getElementById('year-select');
        const selectedYear = document.getElementById('selected-year');
        selectedYear.textContent = yearSelect.value;
      }

      function activateSectionFromHash() {
        const hash = window.location.hash || '#insights';
        const activeLink = document.querySelector(`.nav-link[href="${hash}"]`);
        if (activeLink) {
          document.querySelectorAll('.nav-link').forEach(nav => nav.classList.remove('bg-neutral-100', 'font-bold'));
          activeLink.classList.add('bg-neutral-100', 'font-bold');
          document.querySelectorAll('.section').forEach(section => section.classList.add('hidden'));
          const targetSection = document.querySelector(hash);
          if (targetSection) {
            targetSection.classList.remove('hidden');
          }
        }
      }

      activateSectionFromHash();
      window.addEventListener('hashchange', activateSectionFromHash);

      function toggleMobileMenu() {
        const mobileNav = document.getElementById('mobile-nav');
        mobileNav.classList.toggle('hidden');
      }
    </script>
  </body>
</html>
