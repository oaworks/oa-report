<!DOCTYPE html>
<html lang="en">
  {% include 'partials/head.njk' %}
  <body class="bg-neutral-50 text-neutral-900 font-sans">

    <div class="flex h-screen">
      <!-- Left nav that takes up the full height -->
      <nav aria-label="Primary" class="bg-white w-52 p-4 text-neutral-800 border-r border-neutral-200 shadow-md hidden sm:flex flex-col justify-between fixed inset-y-0 overflow-y-auto">
        <!-- Add time filter section with dropdown for years -->
        <div class="space-y-4">
          <div class="text-xs font-semibold text-neutral-500 uppercase">Date selection</div>
          <!-- Dropdown for year selection -->
          <select aria-label="Select a year" class="appearance-none w-full bg-neutral-100 hover:bg-neutral-200 focus:ring-2 focus:ring-carnation-200 p-2 rounded-sm text-sm shadow-sm">
            <option value="2024">2024</option>
            <option value="2023">2023</option>
            <option value="2022">2022</option>
          </select>
          <!-- Date picker button -->
          <button aria-haspopup="dialog" aria-controls="modal" aria-expanded="false" aria-label="Open date range picker" class="bg-neutral-100 hover:bg-neutral-200 focus:ring-2 focus:ring-carnation-200 p-2 rounded-sm text-sm shadow-sm w-full" onclick="toggleDateRangeModal()">Pick date range</button>

          <div class="text-xs font-semibold text-neutral-500 uppercase">Main menu</div>
          <a href="#insights" class="nav-link p-3 flex items-center space-x-2 font-medium hover:bg-neutral-100 focus:ring-2 focus:ring-carnation-500 transition duration-300 ease-in-out text-sm">
            {% icon_small "bar-chart" %}
            <span>Insights</span>
          </a>
          <a href="#data-explore" class="nav-link p-3 flex items-center space-x-2 font-medium hover:bg-neutral-100 focus:ring-2 focus:ring-carnation-500 transition duration-300 ease-in-out text-sm">
            {% icon_small "grid" %}
            <span>Data explore</span>
          </a>
          <a href="#actions" class="nav-link p-3 flex items-center space-x-2 font-medium hover:bg-neutral-100 focus:ring-2 focus:ring-carnation-500 transition duration-300 ease-in-out text-sm">
            {% icon_small "activity" %}
            <span>Actions</span>
          </a>

          <div class="text-xs font-semibold text-neutral-500 uppercase mt-6">Secondary</div>
          <a href="#about" class="nav-link p-3 flex items-center space-x-2 font-medium hover:bg-neutral-100 focus:ring-2 focus:ring-carnation-500 transition duration-300 ease-in-out text-sm">
            {% icon_small "info" %}
            <span>About</span>
          </a>
          <a href="#logout" class="nav-link p-3 flex items-center space-x-2 font-medium hover:bg-neutral-100 focus:ring-2 focus:ring-carnation-500 transition duration-300 ease-in-out text-sm">
            {% icon_small "log-out" %}
            <span>Log out</span>
          </a>
        </div>
      </nav>

      <!-- Content section and top nav next to the left nav -->
      <div class="flex-grow sm:ml-52">
        <!-- Sticky top navigation bar -->
        <nav aria-label="Secondary" class="bg-white text-neutral-900 border-b border-neutral-200 p-4 shadow-sm sticky top-0 z-50">
          <div class="flex justify-between items-center">
            <div class="flex items-center space-x-6">
              <h2 class="text-2xl font-bold">OA.Report</h2>
              <!-- Bill & Melinda Gates Foundation title aligned with date picker -->
              <h1 class="text-xl text-neutral-500 border-l border-neutral-300 pl-4 ml-4 hidden sm:block">Bill & Melinda Gates Foundation: 1 Jan 2024 â€” 31 Dec 2024</h1>
            </div>
          </div>
        </nav>

        <!-- Main content -->
        <main class="p-6 bg-neutral-50">
          <section id="insights" class="section scroll-mt-16">
            <h2 class="text-2xl font-bold mb-6">Insights</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
              <div class="bg-white p-6 border border-neutral-300 rounded shadow-md">
                <h2 class="text-xl font-semibold text-neutral-700">Total publications</h2>
                <p class="text-4xl mt-2 text-neutral-900">2,365</p>
              </div>
              <div class="bg-white p-6 border border-neutral-300 rounded shadow-md">
                <h2 class="text-xl font-semibold text-neutral-700">Free-to-read</h2>
                <p class="text-4xl mt-2 text-neutral-900">90%</p>
              </div>
              <div class="bg-white p-6 border border-neutral-300 rounded shadow-md">
                <h2 class="text-xl font-semibold text-neutral-700">OA policy-compliant</h2>
                <p class="text-4xl mt-2 text-neutral-900">83%</p>
              </div>
              <div class="bg-white p-6 border border-neutral-300 rounded shadow-md">
                <h2 class="text-xl font-semibold text-neutral-700">With data availability</h2>
                <p class="text-4xl mt-2 text-neutral-900">74%</p>
              </div>
            </div>
          </section>

          <section id="data-explore" class="section hidden scroll-mt-16">
            <h2 class="text-2xl font-bold mb-6">Data exploration</h2>
          </section>

          <section id="actions" class="section hidden scroll-mt-16">
            <h2 class="text-2xl font-bold mb-6">Actions</h2>
          </section>
        </main>
      </div>
    </div>

    <!-- Modal for date picker -->
    <div id="modal" role="dialog" aria-labelledby="modal-title" aria-hidden="true" class="fixed bg-white border border-neutral-300 shadow-lg p-4 hidden" style="z-index: 100;">
      <div class="flex justify-between items-center">
        <h2 id="modal-title" class="text-xl font-semibold">Pick a custom date range</h2>
        <button id="modal-close-btn" aria-label="Close date range picker" class="text-neutral-600 hover:text-neutral-900" onclick="toggleDateRangeModal()">
          {% icon_small "x" %}
        </button>
      </div>
      <label class="block mb-2">Start Date: <input type="date" class="border p-2 rounded"></label>
      <label class="block mb-4">End Date: <input type="date" class="border p-2 rounded"></label>
      <button class="bg-carnation-500 hover:bg-carnation-600 text-white p-2 rounded" onclick="toggleDateRangeModal()">Apply</button>
    </div>

    <script>
      // Function for showing/hiding modal
      function toggleDateRangeModal() {
        const modal = document.getElementById('modal');
        modal.classList.toggle('hidden');
        const button = event.currentTarget;
        const rect = button.getBoundingClientRect();
        modal.style.top = `${rect.bottom + window.scrollY}px`; // Ensures it opens below the button
        modal.style.left = `${rect.left}px`; // Opens aligned to the button
        modal.setAttribute('aria-hidden', modal.classList.contains('hidden'));
      }

      // Handle tab navigation via URL hash
      function activateSectionFromHash() {
        const hash = window.location.hash || '#insights'; // Default to 'insights' section
        const activeLink = document.querySelector(`.nav-link[href="${hash}"]`);
        const currentSectionText = document.getElementById('current-section'); // Check if current-section exists

        if (activeLink) {
          // Remove active state from all links and sections
          document.querySelectorAll('.nav-link').forEach(nav => nav.classList.remove('bg-neutral-100', 'font-bold'));
          activeLink.classList.add('bg-neutral-100', 'font-bold');

          // Hide all sections and show the target section
          document.querySelectorAll('.section').forEach(section => section.classList.add('hidden'));
          const targetSection = document.querySelector(hash);
          if (targetSection) {
            targetSection.classList.remove('hidden');
          }

          // Update the current section text (for mobile navigation only)
          if (currentSectionText) {
            currentSectionText.textContent = activeLink.textContent.trim(); // Only set if the element exists
          }
        }
      }

      // Initial activation on page load
      activateSectionFromHash();

      // Handle hash change
      window.addEventListener('hashchange', activateSectionFromHash);

      // Toggle mobile nav
      function toggleMobileMenu() {
        const mobileNav = document.getElementById('mobile-nav');
        mobileNav.classList.toggle('hidden');
      }
    </script>
  </body>
</html>
